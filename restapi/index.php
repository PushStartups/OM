<?php
use \Psr\Http\Message\ServerRequestInterface as Request;
use \Psr\Http\Message\ResponseInterface as Response;

require      'vendor/autoload.php';
require      'PHPMailer/PHPMailerAutoload.php';
require_once 'inc/initDb.php';

use Voucherify\VoucherifyClient;
use Voucherify\VoucherBuilder;
use Voucherify\CustomerBuilder;
use Voucherify\ClientException;
use Mailgun\Mailgun;



DB::query("set names utf8");


// EMAIL SERVERS FOR EACH EMAIL ADDRESS

// DEV SERVER
if($_SERVER['HTTP_HOST'] == "dev.orderapp.com")
{
    define("EMAIL","devorders@orderapp.com");
    define("B2BEMAIL","devb2b.orderapp.com");
}

// QA SERVER
else if($_SERVER['HTTP_HOST'] == "qa.orderapp.com"){

    define("EMAIL","qaorders@orderapp.com");
    define("B2BEMAIL","qab2b.orderapp.com");
}


// PRODUCTION SERVER
else
{
    define("EMAIL","orders@orderapp.com");
    define("B2BEMAIL","b2b.orderapp.com");
}



// SLIM INITIALIZATION
$app = new \Slim\App();
$app = new \Slim\App();


//  GET LIST OF CITIES
//  WEB HOOK GET LIST OF CITIES AVAILABLE
$app->post('/get_all_cities', function ($request, $response, $args)
{
    try{

        // MINIMUM ORDER AMOUNT
        $cities = DB::query("select * from cities");

        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode($cities));
        return $response;


    }
    catch(MeekroDBException $e) {

        $response =  $response->withStatus(500);
        $response =  $response->withHeader('Content-Type', 'text/html');
        $response =  $response->write( $e->getMessage());
        return $response;
    }

});



$app->post('/save_category_image', function ($request, $response, $args)
{
    $resp = "";
    $data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGcAAABnCAYAAAAdQVz5AAAACXBIWXMAAAsTAAALEwEAmpwYAAA7jGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDozNGQ4MzdlOS05MTI4LTRlNTgtYjg1YS1hZDY3OWMxZTllZjQ8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmY1YzNlMDhkLTc5ZTctMTE3YS1iYmYzLWY1MTVlODhiOTY0YjwveG1wTU06RG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDo3ZTIyNzE3Yi0yOGI3LTRkNmYtOTU1Zi0wZjAzNDlmMWFlZmQ8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgIDxzdFJlZjppbnN0YW5jZUlEPnhtcC5paWQ6ZTk1YThjMzYtMmU4ZC00ZTc4LWEwYzItM2RkOTIyZTRlYjg3PC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpwaG90b3Nob3A6ZTJlMTcxNjYtNGY4ZS0xMTdhLTgxZGItYzYyMjM3NDI1NzJlPC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6M2UyMzg2YTctMTJlMC00YzMzLWI1NjgtNGVhNzQ2OGJkY2RlPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE3LTA1LTE1VDE1OjMwOjUwKzA1OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6N2UyMjcxN2ItMjhiNy00ZDZmLTk1NWYtMGYwMzQ5ZjFhZWZkPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE3LTA1LTE1VDE1OjMwOjUwKzA1OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChNYWNpbnRvc2gpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE3LTA1LTE1VDE1OjI4OjQxKzA1OjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTctMDUtMTVUMTU6MzA6NTArMDU6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE3LTA1LTE1VDE1OjMwOjUwKzA1OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+MTAzPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjEwMzwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5k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';

    $id = $request->getParam('cat_id');
    $menu_id = $request->getParam('menu_id');

    $rests = DB::queryFirstRow("select * from categories where id = '".$id."'");
    if(DB::count() != 0) {
        $data = $rests['image_url'];
    }
    $data = base64_decode(preg_replace('#^data:image/\w+;base64,#i', '', $data));



    $menu_id = DB::queryFirstRow("select restaurant_id from menus where id = '".$menu_id."'");

    $restaurant = DB::queryFirstRow("select * from restaurants where id = '".$menu_id['restaurant_id']."'");






    $restaurant['name_en'] = preg_replace('/\s*/', '', $restaurant['name_en']);

    $restaurant['name_en'] = strtolower($restaurant['name_en']);


    $rests['name_en'] = preg_replace('/\s*/', '', $rests['name_en']);

    $rests['name_en'] = strtolower($rests['name_en']);



    //"/m/en/img/categories/".$restaurant['name_en']."/".$_POST['name_en'].".png"
    if(!is_dir("../m/en/img/categories/" . $restaurant['name_en'])) {
        mkdir("../m/en/img/categories/" . $restaurant['name_en'], 0777);

    }

    
    $filepath = "../m/en/img/categories/".$restaurant['name_en']."/".$rests['name_en'].".png"; // or image.jpg


    $image_url = "";
    if(file_put_contents($filepath,$data))
    {
        $image_url = "/m/en/img/categories/".$restaurant['name_en']."/".$rests['name_en'].".png";
        $resp =  "working";

    }
    else{

        $resp = "not workign";
        $image_url = "/m/en/img/cs-logo.png";
    }
    DB::query("update categories set image_url = '".$image_url."' where id = '$id'");

    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($resp));
    return $response;

});


$app->post('/insert_new_restaurant', function ($request, $response, $args)
{
    $resp = "";
    $data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGcAAABnCAYAAAAdQVz5AAAACXBIWXMAAAsTAAALEwEAmpwYAAA7jGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiCiAgICAgICAgICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDozNGQ4MzdlOS05MTI4LTRlNTgtYjg1YS1hZDY3OWMxZTllZjQ8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmY1YzNlMDhkLTc5ZTctMTE3YS1iYmYzLWY1MTVlODhiOTY0YjwveG1wTU06RG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDo3ZTIyNzE3Yi0yOGI3LTRkNmYtOTU1Zi0wZjAzNDlmMWFlZmQ8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgIDxzdFJlZjppbnN0YW5jZUlEPnhtcC5paWQ6ZTk1YThjMzYtMmU4ZC00ZTc4LWEwYzItM2RkOTIyZTRlYjg3PC9zdFJlZjppbnN0YW5jZUlEPgogICAgICAgICAgICA8c3RSZWY6ZG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpwaG90b3Nob3A6ZTJlMTcxNjYtNGY4ZS0xMTdhLTgxZGItYzYyMjM3NDI1NzJlPC9zdFJlZjpkb2N1bWVudElEPgogICAgICAgICA8L3htcE1NOkRlcml2ZWRGcm9tPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6M2UyMzg2YTctMTJlMC00YzMzLWI1NjgtNGVhNzQ2OGJkY2RlPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE3LTA1LTE1VDE1OjMwOjUwKzA1OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6N2UyMjcxN2ItMjhiNy00ZDZmLTk1NWYtMGYwMzQ5ZjFhZWZkPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE3LTA1LTE1VDE1OjMwOjUwKzA1OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChNYWNpbnRvc2gpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE3LTA1LTE1VDE1OjI4OjQxKzA1OjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTctMDUtMTVUMTU6MzA6NTArMDU6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE3LTA1LTE1VDE1OjMwOjUwKzA1OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+MTAzPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjEwMzwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5k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';

    $id = $request->getParam('rest_id');

    $rests = DB::queryFirstRow("select * from restaurants where id = '".$id."'");

    if(DB::count() != 0) {

        $data = $rests['logo'];

    }

    $data = base64_decode(preg_replace('#^data:image/\w+;base64,#i', '', $data));

    $name_logo = preg_replace('/\s*/', '', $rests['name_en']);

    $name_logo = strtolower($name_logo);

    $filepath = "../m/en/img/".$name_logo."_logo.png"; // or image.jpg


    $image_url = "";
    if(file_put_contents($filepath,$data))
    {
        $image_url = "/m/en/img/".$name_logo."_logo.png";
        $resp =  "working";

    }
    else{

        $resp = "not workign";
        $image_url = "/m/en/img/cs-logo.png";
    }
    DB::query("update restaurants set logo = '".$image_url."' where id = '$id'");

    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($resp));
    return $response;

});




//  WEB HOOK GET MINIMUM ORDER AMOUNT
$app->post('/get_min_order_amount', function ($request, $response, $args)
{
    try {

        // MINIMUM ORDER AMOUNT
        $minOrder = DB::query("select * from default_settings where name = 'min_order'");

        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode($minOrder));
        return $response;
    }
    catch(MeekroDBException $e) {

        $response =  $response->withStatus(500);
        $response =  $response->withHeader('Content-Type', 'text/html');
        $response =  $response->write( $e->getMessage());
        return $response;
    }
});



//  WEB HOOK GET ALL RESTAURANT
$app->post('/get_all_restaurants', function ($request, $response, $args)
{

    try {

        $id = $request->getParam('city_id');


        $restaurants = Array();

        $results = DB::query("select * from restaurants  where city_id = '$id' and hide = 0 order by sort ASC ");

        $count = 0;

        foreach ($results as $result) {
            // GET TAGS OF RESTAURANT i.e BURGER , PIZZA

            $tagsIds = DB::query("select tag_id from restaurant_tags where restaurant_id = '" . $result['id'] . "'");

            $tags = Array();
            $count2 = 0;
            $hoursLeftToOpen = null;

            foreach ($tagsIds as $id) {

                $tag = DB::queryFirstRow("select * from tags where id = '" . $id["tag_id"] . "'");
                $tags[$count2] = $tag;
                $count2++;
            };

            // GET GALLERY OF RESTAURANT

            $galleryImages = DB::query("select url from restaurant_gallery where restaurant_id = '" . $result['id'] . "'");


            // RETRIEVING RESTAURANT TIMINGS i.e SUNDAY   STAT_TIME : 12:00  END_TIME 21:00;

            $restaurantTimings = DB::query("select * from weekly_availibility where restaurant_id = '" . $result['id'] . "'");

            // CURRENT TIME OF ISRAEL
            date_default_timezone_set("Asia/Jerusalem");
            $currentTime = date("H:i");
            $tempDate = date("d/m/Y");
            $dayOfWeek = date('l');

            // RESTAURANT AVAILABILITY ACCORDING TO TIME
            $currentStatus = false;

            $today_timings = "";
            $today_timings_he = "";


            foreach ($restaurantTimings as $singleTime) {


                if ($singleTime['week_en'] == $dayOfWeek) {


                    $today_timings = $singleTime['opening_time'] . " - " . $singleTime['closing_time'];
                    $today_timings_he = $singleTime['opening_time_he'] . " - " . $singleTime['closing_time_he'];
                    $openingTime = DateTime::createFromFormat('H:i', $singleTime['opening_time']);
                    $closingTime = DateTime::createFromFormat('H:i', $singleTime['closing_time']);
                    $currentTime = DateTime::createFromFormat('H:i', $currentTime);


                    if ($currentTime >= $openingTime && $currentTime <= $closingTime) {

                        $currentStatus = true;

                        break;
                    } else {

                        $hoursLeftToOpen = "Open On Sunday";


                    }

                }
            }

            $delivery_fee = DB::query("select * from delivery_fee where restaurant_id = '".$result['id']."'");

            $min = $delivery_fee[0]["fee"];
            $max = $delivery_fee[0]["fee"];

            // CALCULATING MINIMUM AND MAXIMUM DELIVERY FEE
            foreach ($delivery_fee as $fee) {
                if ($fee['fee'] > $max)
                    $max = $fee['fee'];
                else if ($fee['fee'] < $min)
                    $min = $fee['fee'];
            }


            // CREATE DEFAULT RESTAURANT OBJECT;
            $restaurant = [

                "min_delivery"         => $min,                         // MINIMUM DELIVERY FEE
                "max_delivery"         => $max,                         // MAXIMUM DELIVERY FEE
                "id"                   => $result["id"],                // RESTAURANT ID
                "name_en"              => $result["name_en"],           // RESTAURANT NAME
                "name_he"              => $result["name_he"],           // RESTAURANT NAME
                "min_amount"           => $result["min_amount"],        // RESTAURANT MINIMUM AMOUNT
                "logo"                 => $result["logo"],              // RESTAURANT LOGO
                "description_en"       => $result["description_en"],    // RESTAURANT DESCRIPTION
                "description_he"       => $result["description_he"],    // RESTAURANT DESCRIPTION
                "address_en"           => $result["address_en"],        // RESTAURANT ADDRESS
                "address_he"           => $result["address_he"],        // RESTAURANT ADDRESS
                "hechsher_en"          => $result["hechsher_en"],       // RESTAURANT HECHSHER
                "hechsher_he"          => $result["hechsher_he"],       // RESTAURANT HECHSHER
                "coming_soon"          => $result["coming_soon"],       // RESTAURANT COMING SOON
                "pickup_hide"          => $result["pickup_hide"],       // HIDE PICK UP OPTION
                "tags"                 => $tags,                        // RESTAURANT TAGS
                "gallery"              => $galleryImages,               // RESTAURANT GALLERY
                "timings"              => $restaurantTimings,           // RESTAURANT WEEKLY TIMINGS
                "availability"         => $currentStatus,               // RESTAURANT CURRENT AVAILABILITY
                "today_timings"        => $today_timings,               // TODAY TIMINGS
                "today_timings_he"     => $today_timings_he,            // TODAY TIMINGS HE
                "hours_left_to_open"   => $hoursLeftToOpen,             // HOURS LEFT TO OPEN FROM CURRENT TIME
                "delivery_fee"         => $delivery_fee,                // DELIVERY FEE AREA WISE
                "contact"              => $result['contact']            // CONTACT NO
            ];

            $restaurants[$count] = $restaurant;
            $count++;
        }


        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode($restaurants));
        return $response;

    }
    catch(MeekroDBException $e) {

        $response =  $response->withStatus(500);
        $response =  $response->withHeader('Content-Type', 'text/html');
        $response =  $response->write( $e->getMessage());
        return $response;
    }

});


//  WEB HOOK GET DATA OF CATEGORIES WITH ITEMS

$app->post('/categories_with_items', function ($request, $response, $args)
{
    try {

        $id = $request->getParam('restaurantId');

        // GET MENUS FOR RESTAURANT i.e LUNCH
        $menu = DB::queryFirstRow("select * from menus where restaurant_id = '" . $id . "'");

        // GET CATEGORIES OF RESTAURANT i.e ANGUS SALAD , ANGUS BURGER
        $categories = DB::query("select * from categories where menu_id = '" . $menu['id'] . "'");

        $count2 = 0;

        $items = '';

        foreach ($categories as $category) {

            $items = array();

            if($category['business_offer'] == 0) {

                $items = DB::query("select * from items where category_id = '" . $category["id"] . "' and hide = '0'");

            }
            else {

//                // BUSINESS LUNCH CATEGORY GET SELECTED ITEMS
                $first_day_this_month = date('Y-m-01');
                $firstDayOfMonth = $first_day_this_month;

                $currentDate = date('Y-m-d');

                $dtCurrent      = DateTime::createFromFormat('Y-m-d', $currentDate);
                $dtFirstOfMonth = DateTime::createFromFormat('Y-m-d', $firstDayOfMonth);

                $numWeeks = 1 + (intval($dtCurrent->format("W")) - intval($dtFirstOfMonth->format("W")));

                $dayOfWeek = date('l');

                $businessItemsIds = DB::query("select item_id from business_lunch_detail where category_id = '" . $category["id"] . "' AND  week_day = '$dayOfWeek' AND week_cycle = '$numWeeks'");


                foreach ($businessItemsIds as $businessItem) {

                    $item = DB::queryFirstRow("select * from items where category_id = '" . $category["id"] . "' and hide = '0' and id = '".$businessItem['item_id']."'");

                    array_push($items, $item);
                }

            }

            $count3 = 0;

            // CHECK FOR ITEMS PRICE ZERO
            foreach ($items as $item) {

                if ($item['price'] == 0) {

                    $extras = DB::query("select * from extras where item_id = '" . $item["id"] . "' AND type = 'One' AND price_replace=1");
                    // EXTRAS WITH TYPE OME AND PRICE REPLACE 1

                    foreach ($extras as $extra) {

                        $subItems = DB::query("select * from subitems where extra_id = '" . $extra["id"] . "'");
                        $lowestPrice = $subItems[0]['price'];

                        foreach ($subItems as $subitem) {

                            if ($subitem['price'] < $lowestPrice) {
                                $lowestPrice = $subitem['price'];
                            }

                        }

                        $items[$count3]['price'] = $lowestPrice;

                    }
                    //break;
                }

                $count3++;
            }


            $categories[$count2]['items'] = $items;
            $count2++;
        }

        // CREATE DEFAULT OBJECT FOR ITEMS AND CATEGORIES;
        $data = [
            "menu_name_en" => $menu['name_en'],               // MENU NAME EN
            "menu_name_he" => $menu['name_he'],               // MENU NAME HE
            "categories_items" => $categories                 // CATEGORIES AND ITEMS
        ];


        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode($data));
        return $response;

    }
    catch(MeekroDBException $e) {

        $response =  $response->withStatus(500);
        $response =  $response->withHeader('Content-Type', 'text/html');
        $response =  $response->write( $e->getMessage());
        return $response;
    }

});




// GET EXTRAS WITH SUBITEMS
$app->post('/extras_with_subitems', function ($request, $response, $args) {

    try {

        //GETTING ITEM_ID FROM CLIENT SIDE
        $item_id = $request->getParam('itemId');

        //GETTING EXTRAS OF ITEMS i,e ADDONS,SAUCES ETC
        $extra = DB::query("select * from extras where item_id = '$item_id'");

        $countExtra = 0;

        foreach ($extra as $extras) {
            //GETTING SUNITEMS OF EXTRAS i,e KETCHUP,AMERICAN FRIES
            $subItems = DB::query("select * from subitems where extra_id = '" . $extras["id"] . "'");

            $extra[$countExtra]['subitems'] = $subItems;

            $countExtra++;

        }
        $data = [
            "extra_with_subitems" => $extra                           // EXTRA AND ITEMS
        ];


        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode($data));
        return $response;
    }
    catch(MeekroDBException $e) {

        $response =  $response->withStatus(500);
        $response =  $response->withHeader('Content-Type', 'text/html');
        $response =  $response->write( $e->getMessage());
        return $response;
    }

});


// VALIDATE COUPONS

$app->post('/coupon_validation', function ($request, $response, $args) {


    try {

        $email              =   $request->getParam('email');          //  GET USER EMAIL
        $coupon_code        =   $request->getParam('code');           //  COUPON CODE ENTER BY USER
        $order_amount       =   $request->getParam('total');          //  ORDER AMOUNT
        $restaurant_title   =   $request->getParam('rest_title');     //  RESTAURANT TITLE
        $restaurant_city    =   $request->getParam('rest_city');      //  RESTAURANT CITY
        $delivery_fee       =   $request->getParam('delivery_fee');   //  DELIVERY FEE
        $user_order         =   $request->getParam('user_order');     //  USER ORDER
        $success_validation =   "false";                              //  SUCCESS VALIDATION RESPONSE FOR USER
        $user_id            =   null;

        $isUniqueUser       =   false;


        //CHECK IF USER ALREADY EXIST, IF NO CREATE USER
        $getUser = DB::queryFirstRow("select id,smooch_id from users where smooch_id = '$email'");

        if (DB::count() == 0) {

            // USER NOT EXIST IN DATABASE, SO CREATE USER IN DATABASE
            DB::insert('users', array(
                'smooch_id' => $email,
                'email' => $email
            ));

            $user_id = DB::insertId();

            $isUniqueUser = true;
        }
        else {

            // IF USER ALREADY EXIST IN DATABASE
            $user_id = $getUser['id'];
        }

        // COUPON VALIDATION
        $coupon_code = strtoupper($coupon_code);

        $res = VoucherifyValidation($coupon_code,$user_id,($order_amount * 100),$restaurant_title,$restaurant_city,$delivery_fee,$user_order,$isUniqueUser);


        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode($res));
        return $response;

    }
    catch(MeekroDBException $e) {

        $response =  $response->withStatus(500);
        $response =  $response->withHeader('Content-Type', 'text/html');
        $response =  $response->write( $e->getMessage());
        return $response;
    }

});



function VoucherifyValidation($userCoupon,$user_id,$order_amount,$rest_title,$rest_city,$delivery_fee,$user_order,$isUniqueUser)
{

    $apiID          = "6243c07e-fea0-4f0d-89f8-243d589db97b";
    $apiKey         = "ac0d95c8-b5fd-4484-a697-41a1a91f3dd2";
    $voucherify     =  new VoucherifyClient($apiID, $apiKey);
    $data = '';


    $result = DB::queryFirstRow("select * from users where id = '$user_id'");

    $Vid = $result['voucherify_id'];



    // USER NOT EXIST ON VOUCHERIFY
    if($Vid == "" || $Vid == null)
    {

        try {

            $customer = (new CustomerBuilder())
                ->setName($result['name'])
                ->setEmail($result['email'])
                ->setDescription("OrderApp website2.0 User")
                ->setMetadata((object)array("lang" => "en"))
                ->build();

            $vResult = $voucherify->customer->create($customer);


            DB::query("update users set voucherify_id = '".$vResult->id."' where id = '$user_id'");


            $Vid =  $vResult->id;


        }
        catch (ClientException $e)
        {
            $data = [

                "success" => false  // SUCCESS FALSE WRONG CODE

            ];
            return $data;
        }
    }


    try {

        $result =  $voucherify->get($userCoupon);

        if($result->discount->type == "UNIT" && $delivery_fee == "null")
        {
            $data = [

                "success" => false,                                       // COUPON VALID OR NOT (TRUE OR FALSE)
                "deliveryFree" => true,                                   //  COUPON DISCOUNT
                "message" => "Error Coupon is valid only in case of Delivery"
            ];


            return $data;

        }



        // PREPARE META DATA ON ITEMS SELECTED
        // FOR COUPON REDUMPTION VALIDATION

        $metaData = [

            "restaurant" => $rest_title,
            "city" => $rest_city,
            "unique user" => $isUniqueUser

        ];


        foreach ($user_order['orders'] as $order) {

            $metaData[$order['itemName']] =  $order['itemName'];
        }




        $resultRedeem = $voucherify->redeem([
            "voucher" => $userCoupon,
            "customer" => [
                "id" =>  $Vid
            ],
            "order" => [
                "amount" => $order_amount
            ],
            "metadata" => $metaData

        ], NULL);



        if($resultRedeem->voucher->discount->type == "AMOUNT")
        {
            $dAmount = ($resultRedeem->voucher->discount->amount_off / 100);

            $data = [

                "success" => true,                                         // COUPON VALID OR NOT (TRUE OR FALSE)
                "amount" => $dAmount,                                      // DISCOUNT ON COUPON
                "isFixAmountCoupon" => true                                // COUPON TYPE (AMOUNT OR PERCENTAGE)

            ];


            return $data;


        }
        else if($resultRedeem->voucher->discount->type == "PERCENT")
        {
            $dAmount = $resultRedeem->voucher->discount->percent_off;


            $data = [

                "success" => true,                                         // COUPON VALID OR NOT (TRUE OR FALSE)
                "amount" => $dAmount,                                      // DISCOUNT ON COUPON
                "isFixAmountCoupon" => false,                              // COUPON TYPE (AMOUNT OR PERCENTAGE)
                "deliveryFree" => false
            ];


            return $data;
        }
        else if($resultRedeem->voucher->discount->type == "PERCENT")
        {
            $dAmount = $resultRedeem->voucher->discount->percent_off;


            $data = [

                "success" => true,                                         // COUPON VALID OR NOT (TRUE OR FALSE)
                "amount" => $dAmount,                                      // DISCOUNT ON COUPON
                "isFixAmountCoupon" => false,                             // COUPON TYPE (AMOUNT OR PERCENTAGE)
                "deliveryFree" => false
            ];


            return $data;
        }
        else if($resultRedeem->voucher->discount->type == "UNIT")
        {
            $data = [

                "success" => true,                                         // COUPON VALID OR NOT (TRUE OR FALSE)
                "deliveryFree" => true,                                    //  COUPON DISCOUNT

            ];

            return $data;
        }


    }
    catch (ClientException $e)
    {
        $data = [

            "success" => false,  // SUCCESS FALSE WRONG CODE
            "message" => $e->getMessage()
        ];

        return $data;
    }


    $data = [

        "success" => false  // SUCCESS FALSE WRONG CODE

    ];

    return $data;

}



//  MAIL GUN API EMAIL VALIDATOR
$app->post('/validate_email', function ($request, $response, $args) {
//
    $email      = $request->getParam('email');
    $emailErr   = false;

    if (filter_var($email, FILTER_VALIDATE_EMAIL)) {

        $emailErr = true;
    }


//
////    # Instantiate the client.
//
//    $mgClient = new Mailgun('pubkey-bdbdde601ba26a9d5d1adb7f003284a9');
//
//    $validateAddress = $email;
////
////    # Issue the call to the client.
//    $result = $mgClient->get("address/validate", array('address' => $validateAddress));
////
////    # is_valid is 0 or 1
//    $isValid = $result->http_response_body->is_valid;


    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($emailErr));
    return $response;

});





//  STORE USER INFORMATION
$app->post('/add_new_user', function ($request, $response, $args) {

    $resp               =   'error';
    $user_email         =   $request->getParam('user_email');
    $user_password      =   $request->getParam('user_password');


    //CHECK IF USER ALREADY EXIST, IF NO CREATE USER
    $getUser = DB::queryFirstRow("select id,smooch_id from users where smooch_id = '" . $user_email . "'");

    if (DB::count() == 0) {


        $verification_code  =  rand(1000,5000);
        $verification_code  =  md5($verification_code);


        // USER NOT EXIST IN DATABASE, SO CREATE USER IN DATABASE
        DB::insert('users', array(

            'smooch_id' => $user_email,
            "user_name" => $user_email,
            "password"  => $user_password,
            "name" => '',
            "email" => $user_email,
            "login_verification_hash" => $verification_code,
            "is_signup" => 1
        ));

        sendVerificationEmail($verification_code,$user_email);

        ob_end_clean();

        $resp = 'success';

    }
    else{


        if($getUser['is_signup'] == "0")
        {
            $verification_code  =  rand(1000,5000);
            $verification_code  =  md5($verification_code);

            DB::update('users', array(

                'smooch_id' => $user_email,
                "user_name" => $user_email,
                "password"  => $user_password,
                "email" => $user_email,
                "login_verification_hash" => $verification_code,
                "is_signup" => 1
            ), 'smooch_id = %s', $user_email);

            sendVerificationEmail($verification_code,$user_email);

            ob_end_clean();

            $resp = 'success';

        }
        else {

            if ($getUser['login_verification_hash'] != "success") {

                $resp = "verification_pending";

            } else {

                $resp = "account_exist";
            }

        }
    }


    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($resp));
    return $response;

});


// RESEND EMAIL FOR SIGNUP URL

$app->post('/resend_signup_email', function ($request, $response, $args) {


    $user_email   =   $request->getParam('user_email');
    $resp = '';

    //CHECK IF USER ALREADY EXIST, IF NO CREATE USER
    $getUser = DB::queryFirstRow("select * from users where smooch_id = '" . $user_email . "'");


    if(DB::count() != 0) {

        sendVerificationEmail($getUser['login_verification_hash'], $user_email);
        $resp = 'success';
    }
    else{

        $resp = 'error';
    }

    ob_end_clean();


    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($resp));
    return $response;

});




$app->post('/get_user', function ($request, $response, $args) {

    $resp = "not found";
    $user_smooch_id = $request->getParam('smooch_id');

    $getUser = DB::queryFirstRow("select * from users where smooch_id = '$user_smooch_id'");

    if (DB::count() == 0) {

        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode($resp));
        return $response;

    }


    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($getUser));
    return $response;

});



// RESEND EMAIL FOR SIGNUP URL

$app->post('/user_login', function ($request, $response, $args) {

    $resp = "error";

    $user_email         =   $request->getParam('user_email');
    $user_password      =   $request->getParam('user_password');

    //CHECK IF USER ALREADY EXIST, IF NO CREATE USER
    $getUser = DB::queryFirstRow("select * from users where smooch_id = '$user_email' AND password = '$user_password'");

    if (DB::count() != 0) {


        if($getUser['login_verification_hash'] == 'success')
        {
            $resp = 'success';
        }
        else{

            $resp = 'success';

        }

    }

    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($resp));
    return $response;

});




$app->post('/reset_password', function ($request, $response, $args) {

    $user_email   =   $request->getParam('user_email');
    $resp = '';

    //CHECK IF USER ALREADY EXIST, IF NO CREATE USER
    $getUser = DB::queryFirstRow("select * from users where smooch_id = '" . $user_email . "'");

    if(DB::count() != 0) {

        sendPassword($getUser['password'], $user_email);

        ob_end_clean();

        $resp = 'success';
    }
    else{

        $resp = "error";
    }
    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($resp));
    return $response;

});


//  STORE USER ORDER IN DATABASE
$app->post('/add_order', function ($request, $response, $args) {

    try {

        // GET ORDER RESPONSE FROM USER (CLIENT SIDE)
        $user_order = $request->getParam('user_order');
        $user_platform = $request->getParam('user_platform');
        $browser_info = $request->getParam('browser_info');
        $user_id = null;
        $getUser = null;

        //CHECK IF USER ALREADY EXIST, IF NO CREATE USER


        if($user_order['uid'] != '')
        {
            $getUser = DB::queryFirstRow("select id,smooch_id from users where smooch_id = '" . $user_order['uid'] . "'");
        }
        else{

            $getUser = DB::queryFirstRow("select id,smooch_id from users where smooch_id = '" . $user_order['email'] . "'");
        }

        if (DB::count() == 0) {

            // USER NOT EXIST IN DATABASE, SO CREATE USER IN DATABASE
            DB::insert('users', array(

                'smooch_id' => $user_order['email'],
                'email' => $user_order['email'],
                "contact" => $user_order['contact'],
                "address" => $user_order['deliveryAddress'],
                "name" => $user_order['name']
            ));

            $user_id = DB::insertId();
        } else {

            // IF USER ALREADY EXIST IN DATABASE
            $user_id = $getUser['id'];

            DB::update('users', array(

                'email' => $user_order['email'],
                "contact" => $user_order['contact'],
                "address" => $user_order['deliveryAddress'],
                "name" => $user_order['name']
            ), 'id = %d', $user_id);

        }


        // CHECK IF DISCOUNT GIVEN TO USER ADD IN DB
        $discountType = null;
        $discountValue = 0;

        if ($user_order['isCoupon'] == 'true') {

            if ($user_order['isFixAmountCoupon'] == 'true') {

                $discountType = "fixed value";
            }
            else
            {

                $discountType = "fixed percentage";
            }


            $discountValue = $user_order['discount'];
        }

        $todayDate   =  Date("d/m/Y");
        $db_date     =  Date("Y-m-d");
        $currentTime =  getCurrentTime();


        // CREATE A NEW ORDER AGAINST USER
        DB::insert('user_orders', array(

            'user_id'         => $user_id,
            'restaurant_id'   => $user_order['restaurantId'],
            'total'           => $user_order['total'],
            'coupon_discount' => $discountType,
            'discount_value'  => $discountValue,
            "order_date"      => $db_date." ".$currentTime,
            "platform_info"   => $user_platform,
            'payment_method'  => $user_order['Cash_Card'],
            'transaction_id'  => $user_order['trans_id'],
            'browser_info'    => $browser_info
        ));


        $orderId = DB::insertId();

        foreach ($user_order['cartData'] as $orders) {

            // ADD ORDER DETAIL AGAINST USER
            DB::insert('order_detail', array(

                'order_id' => $orderId,
                'qty' => $orders['qty'],
                'item' => $orders['name'],
                'sub_total' => $orders['price'],
                'sub_items' => $orders['detail']
            ));

        }

        $bot_id = "234472538:AAEwJUUgl0nasYLc3nQtGx4N4bzcqFT-ONs";
        $chat_id = "-165732759";


        telegramAPI($bot_id, $chat_id, createOrderForTelegram($user_order));

        ob_end_clean();


        // SEND EMAIL TO KITCHEN

        email_for_kitchen($user_order, $orderId, $todayDate);

        ob_end_clean();

        email_for_mark($user_order, $orderId, $todayDate);

        ob_end_clean();

        email_for_mark2($user_order, $orderId, $todayDate);

        ob_end_clean();

//
//         CLIENT EMAIL
//         EMAIL ORDER SUMMARY

        if ($user_order['language'] == 'en') {

            email_order_summary_english($user_order, $orderId, $todayDate);

        }
        else {


            email_order_summary_hebrew($user_order, $orderId, $todayDate);

        }


        ob_end_clean();

        // SEND ADMIN COPY EMAIL ORDER SUMMARY

        email_order_summary_hebrew_admin($user_order, $orderId, $todayDate);


        ob_end_clean();



        $delivery_time  = date('H:i:s');

        $delivery_time = strtotime($delivery_time) + 60*60;

        $delivery_time = date('H:i:s',$delivery_time);

        createBringgTask($user_order, $todayDate, $delivery_time) ;

        ob_end_clean();



        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode('success'));
        return $response;

    }
    catch(MeekroDBException $e) {

        $response =  $response->withStatus(500);
        $response =  $response->withHeader('Content-Type', 'text/html');
        $response =  $response->write( $e->getMessage());
        return $response;
    }

});

$app->post('/send_email_to_b2b_users', function ($request, $response, $args) {

    $email          = $request->getParam('email');
    $password       = $request->getParam('password');
    $user_name      = $request->getParam('user_name');

    email_to_b2b_users($email,$password,$user_name);

    ob_end_clean();

    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode('success'));
    return $response;

});


$app->post('/native_app', function ($request, $response, $args) {

    $getUser = "";

    $email          = $request->getParam('email');
    $name           = $request->getParam('name');
    $provider       = $request->getParam('provider');
    $uid            = $request->getParam('uid');
    $contact        = $request->getParam('contact');


//CHECK IF USER ALREADY EXIST, IF NO CREATE USER
    $getUser = DB::queryFirstRow("select id,smooch_id from users where smooch_id = '" . $uid . "'");

    if (DB::count() == 0) {

        DB::insert('users', array(

            'smooch_id' => $uid,
            'provider' => $provider,
            'email' => $email,
            "contact" => $contact,
            "name" => $name,
            "uid" => $uid

        ));

        $getUser = DB::queryFirstRow("select id,smooch_id from users where smooch_id = '" . $uid . "'");

    }

    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson(json_encode($getUser));
    return $response;

});


$app->post('/tcs_printer', function ($request, $response, $args) {

    $result = 'resp';

    try {

        $result =   TCS_Service_Printer();

    }
    catch (Exception $e)
    {
        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson(json_encode("error  ".$e->getMessage()));
        return $response;
    }

    // RESPONSE RETURN TO REST API CALL
    $response = $response->withStatus(202);
    $response = $response->withJson($result);
    return $response;


});

function TCS_Service_Printer()
{
    $API_KEY = 'demoapikey';
    $client = new \GuzzleHttp\Client([

        'timeout' => 100, // NEVER FORGET to set a timeout
        'base_uri' => 'https://imprimo.altercodex.com/api/dev/',
        'headers' => [
            'Authorization' => "Bearer $API_KEY"

        ]

    ]);

    $mystring = "";


    $response = $client->post('devices/356498044821326/requests/', ['json' => [
        'data' =>  $mystring

    ]]);


    return $response->getBody();
}


//  RETURN PAYMENT URL OF GUARD API AGAINST PAYMENT OF USER ORDER
$app->post('/stripe_payment_request', function ($request, $response, $args) {

    try {

        $amount = $request->getParam('amount');
        $creditCardNo = $request->getParam('cc_no');
        $expDate = $request->getParam('exp_date');
        $cvv = $request->getParam('cvv');
        $user_order = $request->getParam('user_order');


        $user_id = 0;

        $getUser = DB::queryFirstRow("select id,smooch_id from users where smooch_id = '".$user_order['email']."'");

        if (DB::count() == 0) {

            // USER NOT EXIST IN DATABASE, SO CREATE USER IN DATABASE
            DB::insert('users', array(
                'smooch_id' => $user_order['email']
            ));

            $user_id = DB::insertId();

        } else {

            // IF USER ALREADY EXIST IN DATABASE
            $user_id = $getUser['id'];
        }

        $result = '';

        if($user_order['language'] == 'en')
        {
            $result = stripePaymentRequest(($amount*100),$user_order,$user_id,$creditCardNo,$expDate,$cvv);
        }
        else{

            $result = stripePaymentRequestHE(($amount*100),$user_order,$user_id,$creditCardNo,$expDate,$cvv);

        }


        // RESPONSE RETURN TO REST API CALL
        $response = $response->withStatus(202);
        $response = $response->withJson($result);
        return $response;
    }
    catch(MeekroDBException $e) {

        $response =  $response->withStatus(500);
        $response =  $response->withHeader('Content-Type', 'text/html');
        $response =  $response->write( $e->getMessage());
        return $response;
    }

});


$app->run();


// SUPPORT METHODS
// STRIPE API PAYMENT REQUEST
// AMOUNT DIVIDED BY 100 FROM API

function  stripePaymentRequest($amount,$user_order,$user_id,$creditCardNo,$expDate,$cvv)
{
    $rest = "Error";
    $cgConf['tid']='8804324';
    $cgConf['amount']=$amount;
    $cgConf['user']='pushstart';
    $cgConf['password']='OE2@38sz';
    $cgConf['cg_gateway_url']="https://cgpay5.creditguard.co.il/xpo/Relay";

    $poststring = 'user='.$cgConf['user'];
    $poststring .= '&password='.$cgConf['password'];

    /*Build Ashrait XML to post*/
    $poststring.='&int_in=<ashrait>
							<request>
							<language>ENG</language>
							<command>doDeal</command>
							<requestId/>
							<version>1000</version>
							<doDeal>
								<terminalNumber>'.$cgConf['tid'].'</terminalNumber>
								<authNumber/>
								<transactionCode>Phone</transactionCode>
								<transactionType>Debit</transactionType>
								<total>'.$cgConf['amount'].'</total>
								<creditType>RegularCredit</creditType>
								<cardNo>'.$creditCardNo.'</cardNo>
								<cvv>'.$cvv.'</cvv>
								<cardExpiration>'.$expDate.'</cardExpiration>
								<validation>AutoComm</validation>
								<numberOfPayments/>
								<customerData>
									<userData1>'.$user_order['email'].'</userData1>
									<userData2/>
									<userData3/>
									<userData4/>
									<userData5/>
								</customerData>
								<currency>ILS</currency>
								<firstPayment/>
								<periodicalPayment/>
								<user>Push</user>	
								
								<invoice>

									<invoiceCreationMethod>wait</invoiceCreationMethod>
									
									<invoiceDate/>
									
									<invoiceSubject>'.$user_order['restaurantTitle'].' Order# '.$user_id.'</invoiceSubject>
									
									<invoiceDiscount/>
									
									<invoiceDiscountRate/>
									
									<invoiceItemCode>'.$user_id.'</invoiceItemCode>
									
									<invoiceItemDescription>'.$user_order['restaurantTitle'].' food order from OrderApp</invoiceItemDescription>
									
									<invoiceItemQuantity>1</invoiceItemQuantity>
									
									<invoiceItemPrice>'.$amount.'</invoiceItemPrice>
									
									<invoiceTaxRate/>
									
									<invoiceComments/>
									
									<companyInfo>OrderApp</companyInfo>
									
									<sendMail>1</sendMail>
									
									<mailTo>'.$user_order['email'].'</mailTo>
									
									<isItemPriceWithTax>0</isItemPriceWithTax>
									
									<ccDate>'.date("Y-m-d").'</ccDate>
									
									<invoiceSignature/>
									
									<invoiceType>receipt</invoiceType>
									
									<DocNotMaam/>
									
								</invoice>	
								
							</doDeal>
						</request>
					</ashrait>';


    //init curl connection
    if( function_exists( "curl_init" )) {
        $CR = curl_init();
        curl_setopt($CR, CURLOPT_URL, $cgConf['cg_gateway_url']);
        curl_setopt($CR, CURLOPT_POST, 1);
        curl_setopt($CR, CURLOPT_FAILONERROR, true);
        curl_setopt($CR, CURLOPT_POSTFIELDS, $poststring);
        curl_setopt($CR, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($CR, CURLOPT_SSL_VERIFYPEER, 0);
        curl_setopt($CR, CURLOPT_FAILONERROR,true);


        //actual curl execution perfom
        $result = curl_exec( $CR );
        $error = curl_error ( $CR );

        // on error - die with error message
        if( !empty( $error )) {
            die($error);
        }

        curl_close($CR);

        $xml  = simplexml_load_string((string) $result);

        if($xml->response->result[0] == 000)
        {
            $rest = [

                "response" => 'success',
                "trans_id" => (string) $xml->response->tranId[0]
            ];

        }
        else{

            $rest = [

                "response" =>  (string) $xml->response->message[0]

            ];

        }

    }

    return $rest;
}

//SEND EMAIL TO B2B USERS CREDENTIALS INFO
function email_to_b2b_users($email,$password,$username)
{

    $mailbody = '<html lang="en">
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>OrderApp</title>';

    //    <style type="text/css">
    //    </style>
    $mailbody .= '</head><body bgcolor="#f7f7f7" style="background: #f7f7f7;">';
    $mailbody .= '<table border="0" cellpadding="0" cellspacing="0" width="600" id="templateColumns" style="color: #000; font-size: 16px; line-height: 18px; font-weight: 400; width: 600px; margin: 0 auto; font-family: Arial, Helvetica, sans-serif;">';
    $mailbody .= '<tr><td align="left" valign="top" width="100%" bgcolor="#ff7f00" style="background: #ff7f00; font-size: 18px; line-height: 22px; font-weight: 700;padding: 20px;">';
    $mailbody .= '<a href="https://orderapp.com" ><img style="display: inline-block; vertical-align: middle; margin: 0;" src="https://dev.orderapp.com/admin/img/email-logo.png" alt="orderapp"></a>';
    $mailbody .= '<h1 style="display: inline-block; vertical-align: middle; margin: 0 10px; font-weight: 400; color: #fff;">Welcome to OrderApp!</h1></td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr>';
    $mailbody .= '<td align="left" valign="top" width="100%" bgcolor="#FFFFFF" style="padding: 50px 25px; background: #fff;">';
    $mailbody .= '<p>Hi '.$username.' <br><br>Your login details are as follows:</p>';
    $mailbody .= '<p><b>Username : </b> '.$username.'</p>';
    $mailbody .= '<p><b>Password : </b> '.$password.'</p><br>';
    $mailbody .= '<p>Visit Website : <a style="color: #3b5998; text-decoration: none;" href="#">'.B2BEMAIL.'</a></p>';
    $mailbody .= '</td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr>';
    $mailbody .= '<td align="center" style="padding: 100px 0 20px;">';
    $mailbody .= '<table border="0" cellspacing="0" cellpadding="0">';
    $mailbody .= '<tr><td width="37" style="text-align: center; padding: 0 8px;"><a href="#"><img src="https://dev.orderapp.com/admin/img/fb.png" width="37" height="37" alt="Facebook" border="0" /></a></td>';
    $mailbody .= '<td width="37" style="text-align: center; padding: 0 8px;"><a href="#"><img src="https://dev.orderapp.com/admin/img/tw.png" width="37" height="37" alt="Twitter" border="0" /></a></td>';
    $mailbody .= '<td width="37" style="text-align: center; padding: 0 8px;"><a href="#"> <img src="https://dev.orderapp.com/admin/img/gp.png" width="37" height="37" alt="Facebook" border="0" /></a></td>';
    $mailbody .= '<td width="37" style="text-align: center; padding: 0 8px;"><a href="#"><img src="https://dev.orderapp.com/admin/img/insta.png" width="37" height="37" alt="Twitter" border="0" /></a></td>';
    $mailbody .= '<td width="37" style="text-align: center; padding: 0 8px;"><a href="#"><img src="https://dev.orderapp.com/admin/img/pin.png" width="37" height="37" alt="Facebook" border="0" /></a></td>';
    $mailbody .= '<td width="37" style="text-align: center; padding: 0 8px;"><a href="#"><img src="https://dev.orderapp.com/admin/img/link.png" width="37" height="37" alt="Twitter" border="0" /></a></td>';
    $mailbody .= '</tr>';
    $mailbody .= '</table>';
    $mailbody .= '</td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr>';
    $mailbody .= '<td><p style="margin: 0; text-align: center;"><a style="color: #797979; text-decoration: none;" href="https://dev.orderapp.com/en/">orderapp.com</a></p></td></tr></table></body></html>';

    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

    //From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


    //To address and name
    $mail->addAddress($email);                    //SEND ADMIN EMAIL


    //Address to which recipient will reply
    $mail->addReplyTo("order@orderapp.com", "Reply");


    //Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = "B2B OrderApp Credentials Info";
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send())
    {
        echo "Mailer Error: " . $mail->ErrorInfo;
    }
    else
    {
        echo "Message has been sent successfully";
    }

}



// STRIPE PAYMENT REQUEST HE

function  stripePaymentRequestHE($amount,$user_order,$user_id,$creditCardNo,$expDate,$cvv)
{
    $rest = "Error";
    $cgConf['tid']='8804324';
    $cgConf['amount']=$amount;
    $cgConf['user']='pushstart';
    $cgConf['password']='OE2@38sz';
    $cgConf['cg_gateway_url']="https://cgpay5.creditguard.co.il/xpo/Relay";

    $poststring = 'user='.$cgConf['user'];
    $poststring .= '&password='.$cgConf['password'];

    /*Build Ashrait XML to post*/
    $poststring.='&int_in=<ashrait>
							<request>
							<language>HEB</language>
							<command>doDeal</command>
							<requestId/>
							<version>1000</version>
							<doDeal>
								<terminalNumber>'.$cgConf['tid'].'</terminalNumber>
								<authNumber/>
								<transactionCode>Phone</transactionCode>
								<transactionType>Debit</transactionType>
								<total>'.$cgConf['amount'].'</total>
								<creditType>RegularCredit</creditType>
								<cardNo>'.$creditCardNo.'</cardNo>
								<cvv>'.$cvv.'</cvv>
								<cardExpiration>'.$expDate.'</cardExpiration>
								<validation>AutoComm</validation>
								<numberOfPayments/>
								<customerData>
									<userData1>'.$user_order['email'].'</userData1>
									<userData2/>
									<userData3/>
									<userData4/>
									<userData5/>
								</customerData>
								<currency>ILS</currency>
								<firstPayment/>
								<periodicalPayment/>
								<user>Push</user>	
								
								<invoice>

									<invoiceCreationMethod>wait</invoiceCreationMethod>
									
									<invoiceDate/>
									
									<invoiceSubject>'.$user_order['restaurantTitle'].' Order# '.$user_id.'</invoiceSubject>
									
									<invoiceDiscount/>
									
									<invoiceDiscountRate/>
									
									<invoiceItemCode>'.$user_id.'</invoiceItemCode>
									
									<invoiceItemDescription>'.$user_order['restaurantTitle'].' food order from OrderApp</invoiceItemDescription>
									
									<invoiceItemQuantity>1</invoiceItemQuantity>
									
									<invoiceItemPrice>'.$amount.'</invoiceItemPrice>
									
									<invoiceTaxRate/>
									
									<invoiceComments/>
									
									<companyInfo>OrderApp</companyInfo>
									
									<sendMail>1</sendMail>
									
									<mailTo>'.$user_order['email'].'</mailTo>
									
									<isItemPriceWithTax>0</isItemPriceWithTax>
									
									<ccDate>'.date("Y-m-d").'</ccDate>
									
									<invoiceSignature/>
									
									<invoiceType>receipt</invoiceType>
									
									<DocNotMaam/>
									
								</invoice>	
								
							</doDeal>
						</request>
					</ashrait>';


    //init curl connection
    if( function_exists( "curl_init" )) {
        $CR = curl_init();
        curl_setopt($CR, CURLOPT_URL, $cgConf['cg_gateway_url']);
        curl_setopt($CR, CURLOPT_POST, 1);
        curl_setopt($CR, CURLOPT_FAILONERROR, true);
        curl_setopt($CR, CURLOPT_POSTFIELDS, $poststring);
        curl_setopt($CR, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($CR, CURLOPT_SSL_VERIFYPEER, 0);
        curl_setopt($CR, CURLOPT_FAILONERROR,true);


        //actual curl execution perfom
        $result = curl_exec( $CR );
        $error = curl_error ( $CR );

        // on error - die with error message
        if( !empty( $error )) {
            die($error);
        }

        curl_close($CR);

        $result = mb_convert_encoding( $result, "HTML-ENTITIES", "UTF-8");

        $xml = simplexml_load_string((string) $result);

        if($xml->response->result[0] == 000)
        {
            $rest = [

                "response" => 'success',
                "trans_id" => (string) $xml->response->tranId[0]
            ];

        }
        else{

            $rest = [

                "response" =>  (string) $xml->response->message[0]

            ];

        }

    }

    return $rest;
}




// CLIENT EMAILS


function sendVerificationEmail($code,$email)
{
    $mailbody  = 'https://'.$_SERVER['HTTP_HOST']."/verification.php?key=".$code.'&email='.$email;

    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

    //From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


    //To address and name
    $mail->addAddress($email);     // SEND EMAIL TO USER


    //Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = 'OrderApp Verification';
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send())
    {
        echo "Mailer Error: " . $mail->ErrorInfo;
    }
    else
    {
        echo "Message has been sent successfully";
    }


}


function sendPassword($password,$email)
{
    $mailbody  = 'your password is '.$password;

    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

    //From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


    //To address and name
    $mail->addAddress($email);     // SEND EMAIL TO USER


    //Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = 'Your Password Reset Request For OrderApp';
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send())
    {
        echo "Mailer Error: " . $mail->ErrorInfo;
    }
    else
    {
        echo "Message has been sent successfully";
    }


}


// EMAIL ORDER SUMMARY ENGLISH VERSION
function email_order_summary_english($user_order,$orderId,$todayDate)
{
    $mailbody  = '<html><head></head>';
    $mailbody .= '<body style="padding: 0; margin: 0" >';
    $mailbody .= '<div style="max-width: 600px; margin: 0 auto; border: 1px solid #D3D3D3; border-radius: 5px " >';
    $mailbody .= '<div style="font-family: Open Sans" src="https://fonts.googleapis.com/css?family=Open+Sans:300">';
    $mailbody .= '<div  style="background-image: url(http://dev.orderapp.com/restapi/images/header.png); background-repeat: no-repeat; background-position: center; background-size: cover;">';
    $mailbody .= '<table style="width: 100%; color: white; padding: 30px" >';
    $mailbody .= '<tr style="font-size: 30px; padding: 10px" >';
    $mailbody .= '<td > <img style="padding-top: 10px; width: 20px" src="http://dev.orderapp.com/restapi/images/bag.png" > Order Summary </td>';
    $mailbody .= '<td style="text-align: right">'.$user_order['total'].' NIS</td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 10px" >';
    $mailbody .= '<td> '.$todayDate.' &nbsp; Order ID # '.$orderId.'</td>';
    $mailbody .= '<td style="text-align: right">'.$user_order['Cash_Card'].'</td>';
    $mailbody .= '</tr>';
    $mailbody .= '</table>';
    $mailbody .= '</div>';


    $mailbody .= '<div  style="padding: 10px 30px 0px 30px;" >';

    foreach($user_order['cartData'] as $t) {

        $mailbody .= '<table style="width: 100%; color:black; padding: 30px 0; border-bottom: 1px solid #D3D3D3" >';

        $mailbody .= '<tr style="font-size: 18px; padding: 10px; font-weight: bold" >';
        // print item name
        $mailbody .= '<td >' . $t['name'] . '  </td>';
        $mailbody .= '<td style="text-align: right; white-space: nowrap"> '.$t['price'].' NIS X '.$t['qty'].'  &nbsp; <span style="color: FF864C;" >'.(($t['price'] * $t['qty'])).' NIS</span></td>';
        $mailbody .= '</tr>';

        // subitems
        $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080" >';


        if($t['specialRequest'] != "") {

            if ($t['detail'] != '') {

                $mailbody .= '<td >' . $t['detail'] .', Special Request : '.$t['specialRequest']. '</td>';
            }
            else {

                $mailbody .= '<td >' . $t['detail'].' Special Request : '.$t['specialRequest'].' </td>';
            }
        }
        else
        {
            $mailbody .= '<td >' . $t['detail'] . ' </td>';
        }


        $mailbody .= '<td style="text-align: right"> </td>';
        $mailbody .= '</tr>';

        $mailbody .= '</table>';

    }

    if($user_order['pickFromRestaurant'] == 'false' && $user_order['deliveryCharges'] != null && $user_order['deliveryCharges'] != 0) {

        $mailbody .= '<table style="width: 100%; color:black; padding: 30px 0; border-bottom: 1px solid #D3D3D3" >';

        $mailbody .= '<tr style="font-size: 18px; padding: 10px; font-weight: bold" >';

        // print item name
        $mailbody .= '<td > Delivery Fee </td>';
        $mailbody .= '<td style="text-align: right; white-space: nowrap"><span style="color: #FF864C;" >' . (($user_order['deliveryCharges'])) . ' NIS</span></td>';
        $mailbody .= '</tr>';

        $mailbody .= '</tr>';
        $mailbody .= '</table>';

    }

    $mailbody .= '</div>';


    $mailbody .= '<table style="width: 100%; color:black; padding:10px 30px; background: #FEF2E8; border-bottom: 1px solid #D3D3D3 " >';

    if($user_order['isCoupon'] == "false")
    {
        $mailbody .= '<tr style="font-size: 18px;  font-weight: bold" >';
        $mailbody .= '<td style="padding: 5px 0" > Total </td>';
        $mailbody .= '<td style="text-align: right; white-space: nowrap"> <span style="color: #FF864C;" >'.$user_order['total'].' NIS</span></td>';
        $mailbody .= '</tr>';
    }
    else
    {
        $mailbody .= '<tr style="font-size: 18px;  font-weight: bold" >';
        $mailbody .= '<td style="padding: 5px 0" > Sub total  </td>';
        $mailbody .= '<td style="text-align: right; white-space: nowrap"> <span style="color: #FF864C;" >'.$user_order['totalWithoutDiscount'].' NIS</span></td>';
        $mailbody .= '</tr>';

        if($user_order['isFixAmountCoupon'] == 'false')
        {
            $amountDiscount = (($user_order['totalWithoutDiscount'] * $user_order['discount']) / 100);

            $mailbody .= '<tr style="font-size: 18px;  font-weight: bold" >';
            $mailbody .= '<td style="padding: 5px 0" > Coupon Discount -'.$user_order['discount'].'% </td>';
            $mailbody .= '<td style="text-align: right; white-space: nowrap"> <span style="color: #FF864C;" >'.$amountDiscount.' NIS</span></td>';
            $mailbody .= '</tr>';
        }
        else
        {
            $mailbody .= '<tr style="font-size: 18px;  font-weight: bold" >';
            $mailbody .= '<td style="padding: 5px 0" > Coupon Discount Amount </td>';
            $mailbody .= '<td style="text-align: right; white-space: nowrap"> <span style="color: #FF864C;" > -'.$user_order['discount'].' NIS</span></td>';
            $mailbody .= '</tr>';

        }

    }


    $mailbody .= '</table>';


    if($user_order['specialRequest'] != '')
    {

        $mailbody .= '<br><span style="color: #000000; padding:10px 30px;">Special Request : <span style="color: #808080">'.$user_order["specialRequest"].'</span></span><br>';

    }


    $mailbody .= '<table style=" color:black; padding:10px 30px; width: 270px; " cellspacing="5px">';
    $mailbody .= '<tr style="font-size: 18px;  font-weight: bold" >';
    $mailbody .= '<td colspan="2" style="padding: 10px 0" > Customer information   </td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080" >';
    $mailbody .= '<td style="padding: 10px 0" > <img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_user.png" ></td>';
    $mailbody .= '<td style="text-align: left; white-space: nowrap"> '.$user_order['name'].' </td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080" >';
    $mailbody .= '<td style="padding: 10px 0" > <img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_phone.png" ></td>';
    $mailbody .= '<td style="text-align: left; white-space: nowrap"> '.$user_order['contact'].' </td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080" >';
    $mailbody .= '<td style="padding: 10px 0; text-align: center" > <img style=" height: 24px" src="http://dev.orderapp.com/restapi/images/ic_location.png" ></td>';

    if($user_order['pickFromRestaurant'] == 'false')
    {
        $mailbody .= '<td style="text-align: left; white-space: nowrap"> Delivery Address : '.$user_order['deliveryAptNo'].'  '.$user_order['deliveryAddress'].' ('.$user_order['deliveryArea'].')'.'</td>';
    }
    else{

        $mailbody .= '<td style="text-align: left; white-space: nowrap"> Pick From Restaurant : '.$user_order['restaurantAddress'].'</td>';
    }


    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080" >';
    $mailbody .= '<td style="padding: 10px 0" > <img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_email.png" ></td>';
    $mailbody .= '<td style="text-align: left; white-space: nowrap"> '.$user_order['email'].' </td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080" >';
    $mailbody .= '<td style="padding: 10px 0" > <img style=" width: 20px" src="http://dev.orderapp.com/restapi/images/ic_card.png" ></td>';
    $mailbody .= '<td style="text-align: left; white-space: nowrap"> '.$user_order['Cash_Card'].' </td>';
    $mailbody .= '</tr>';
    $mailbody .= '</table>';

    $mailbody .= '</div>';
    $mailbody .= '</div>';
    $mailbody .= '</body>';
    $mailbody .= '</html>';

    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

//From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


//To address and name
    $mail->addAddress($user_order['email']);     // SEND EMAIL TO USER

    $mail->AddCC(EMAIL);                        //SEND  CLIENT EMAIL COPY TO ADMIN

//Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = $user_order['restaurantTitle'].' Order# '.$orderId;
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send())
    {
        echo "Mailer Error: " . $mail->ErrorInfo;
    }
    else
    {
        echo "Message has been sent successfully";
    }


}


// EMAIL ORDER SUMMARY HEBREW VERSION

function email_order_summary_hebrew($user_order,$orderId,$todayDate)
{

    $mailbody  = '<html><head><meta charset="UTF-8"></head>';
    $mailbody  .= '<body style="padding: 0; margin: 0" >';
    $mailbody  .= '<div style="max-width: 600px; margin: 0 auto; border: 1px solid #D3D3D3; border-radius: 5px; overflow: hidden; ">';
    $mailbody  .= '<style>';
    $mailbody  .= '@import url("https://fonts.googleapis.com/css?family=Open+Sans:300");';
    $mailbody  .= '</style>';
    $mailbody  .= '<div style="font-family: Open Sans">';
    $mailbody  .= '<div style="background-image: url(http://dev.orderapp.com/restapi/images/header.png); background-repeat: no-repeat; background-position: center; background-size: cover;" >';
    $mailbody  .= '<table style="width: 100%; color: white; padding: 30px">';
    $mailbody  .= '<tr style="font-size: 30px; padding: 10px">';
    $mailbody  .= '<td dir="rtl" style="text-align: left">'.$user_order['total'].' "'.'</td>';
    $mailbody  .= '<td style="text-align: right;" >    <img style="padding-top: 10px; width: 20px" src="http://dev.orderapp.com/restapi/images/bag.png" ></td>';
    $mailbody  .= '</tr>';
    $mailbody  .= '<tr style="font-size: 12px; padding: 10px" >';
    $mailbody  .= '<td>'.$user_order['Cash_Card_he'].'</td>';
    $mailbody  .= '<td style="text-align: right" dir="rtl">';
    $mailbody  .=  '&nbsp;'.$todayDate.'&nbsp;';
    $mailbody  .= '  #';
    $mailbody  .=  $orderId;
    $mailbody  .= '</tr>';
    $mailbody  .= '</table>';
    $mailbody  .= '</div>';
    $mailbody  .= '<div  style="padding: 10px 30px 0px 30px;" >';


    foreach($user_order['cartData'] as $t) {

        $mailbody.='<table style="width: 100%; color:black; padding: 30px 0; border-bottom: 1px solid #D3D3D3" >';
        $mailbody.='<tr style="font-size: 18px; padding: 10px; font-weight: bold" >';
        $mailbody.='<span style="color: #FF864C;" dir="rtl">';
        $mailbody.=(($t['price'] * $t['qty'])).'  " ';
        $mailbody.='</span> &nbsp; <span dir="rtl">"</span>';
        $mailbody.=$t['price'].' x '.$t['qty'].'</td>';
        $mailbody.='<td style="text-align: right;width: 60%" >'. $t['name_he'] .'</td>';
        $mailbody.='</tr>';
        $mailbody.='<tr style="font-size: 12px; padding: 5px 10px; color: #808080" >';
        $mailbody.='<td > </td>';



        if($t['specialRequest'] != "") {

            if ($t['detail_he'] == '') {


                $mailbody.='<td style="text-align: right; padding: 5px" dir="rtl">'.$t['detail_he'].'  : '.$t['specialRequest'].'</td>';

            }
            else {

                $mailbody.='<td style="text-align: right; padding: 5px" dir="rtl">'.$t['detail_he'].',  : '.$t['specialRequest'].'</td>';

            }
        }
        else
        {
            $mailbody.='<td style="text-align: right; padding: 5px" dir="rtl">'.$t['detail_he'].'</td>';

        }





        $mailbody.='</tr>';
        $mailbody.='</table>';
    }


    $mailbody .=  '</div>';


    $mailbody .= '<table style="width: 100%; color:black; padding:10px 30px; background: #FEF2E8; border-bottom: 1px solid #D3D3D3 ">';

    if($user_order['isCoupon'] == "false")
    {

        $mailbody .= '<tr style="font-size: 18px;  font-weight: bold">';
        $mailbody .= '<td style=" white-space: nowrap"> <span style="color: #FF864C;" dir="rtl">'.$user_order['total'].' " '.'</span></td>';
        $mailbody .= '<td style="padding: 5px 0; text-align: right; " > " </td>';
        $mailbody .= '</tr>';

    }
    else
    {
        $mailbody .= '<tr style="font-size: 18px;  font-weight: bold">';
        $mailbody .= '<td style=" white-space: nowrap"> <span style="color: #FF864C;" >'.$user_order['totalWithoutDiscount'].' " '.'</span></td>';
        $mailbody .= '<td style="padding: 5px 0; text-align: right; " >   </td>';
        $mailbody .= '</tr>';


    }

    $mailbody .= '</table>';


    if($user_order['specialRequest'] != '')
    {

        $mailbody .= '<br><span style="color: #000000;text-align: right;float: right;" dir="rtl"> <span style="color: #808080; padding:10px 30px;">  :</span>'.$user_order["specialRequest"].'</span><br>';

    }


    $mailbody .= '<table style="float: right;color:black; padding:10px 30px; width: 270px; position: relative; left: calc(100% - 270px)" cellspacing="5px">';
    $mailbody .= '<tr style="font-size: 18px;  font-weight: bold" >';
    $mailbody .= '<td colspan="2" style="padding: 10px 0; text-align: right" dir="rtl" >     </td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';
    $mailbody .= '<td style="text-align: right; white-space: nowrap"> '.$user_order['name'].' </td>';
    $mailbody .= '<td style="padding: 10px 0"><img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_user.png"></td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';
    $mailbody .= '<td style="text-align: right; white-space: nowrap"> '.$user_order['contact'].' </td>';
    $mailbody .= '<td style="padding: 10px 0"><img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_phone.png"></td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';

    if($user_order['pickFromRestaurant'] == 'false')
    {
        $mailbody .= '<td style="text-align: right; white-space: nowrap" dir="rtl">   : '.$user_order['deliveryAptNo'].'  '.$user_order['deliveryAddress'].' )'.$user_order['deliveryArea'].')</td>';
    }
    else
    {
        $mailbody .= '<td style="text-align: right; white-space: nowrap"dir="rtl">     : '.$user_order['restaurantAddress'].'</td>';
    }

    $mailbody .=  '<td style="padding: 10px 0; text-align: center"> <img style="height: 24px" src="http://dev.orderapp.com/restapi/images/ic_location.png" ></td>';
    $mailbody .=  '</tr>';
    $mailbody .=  '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';
    $mailbody .=  '<td style="text-align: right; white-space: nowrap">'.$user_order['email'].'</td>';
    $mailbody .=  '<td style="padding: 10px 0;"><img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_email.png" ></td>';
    $mailbody .=  '</tr>';
    $mailbody .=  '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';
    $mailbody .=  '<td style="text-align: right; white-space: nowrap">'.$user_order['Cash_Card_he'].'</td>';
    $mailbody .=  '<td style="padding: 10px 0;" > <img style=" width: 20px" src="http://dev.orderapp.com/restapi/images/ic_card.png" ></td>';
    $mailbody .=  '</tr>';
    $mailbody .=  '</table>';

    $mailbody .=  '</div></div></body></html>';




    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

    //From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


    //To address and name
    $mail->addAddress($user_order['email']);     // SEND EMAIL TO USER
    $mail->addAddress(EMAIL);                    //SEND  CLIENT EMAIL COPY TO ADMIN

    //Address to which recipient will reply
    $mail->addReplyTo("order@orderapp.com", "Reply");


    //Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = '  '." ".$user_order['restaurantTitleHe'];
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send())
    {
        echo "Mailer Error: " . $mail->ErrorInfo;
    }
    else
    {
        echo "Message has been sent successfully";
    }

}



// ADMIN EMAIL
// EMAIL ORDER SUMMARY HEBREW VERSION FOR ADMIN
function email_order_summary_hebrew_admin($user_order,$orderId,$todayDate)
{

    $mailbody  = '<html><head><meta charset="UTF-8"></head>';
    $mailbody  .= '<body style="padding: 0; margin: 0" >';
    $mailbody  .= '<div style="max-width: 600px; margin: 0 auto; border: 1px solid #D3D3D3; border-radius: 5px; overflow: hidden; ">';
    $mailbody  .= '<style>';
    $mailbody  .= '@import url("https://fonts.googleapis.com/css?family=Open+Sans:300");';
    $mailbody  .= '</style>';
    $mailbody  .= '<div style="font-family: Open Sans">';
    $mailbody  .= '<div style="background-image: url(http://dev.orderapp.com/restapi/images/header.png); background-repeat: no-repeat; background-position: center; background-size: cover;" >';
    $mailbody  .= '<table style="width: 100%; color: white; padding: 30px">';
    $mailbody  .= '<tr style="font-size: 30px; padding: 10px">';
    $mailbody  .= '<td dir="rtl" style="text-align: left">'.$user_order['total'].' "'.'</td>';
    $mailbody  .= '<td style="text-align: right;" >    <img style="padding-top: 10px; width: 20px" src="http://dev.orderapp.com/restapi/images/bag.png" ></td>';
    $mailbody  .= '</tr>';
    $mailbody  .= '<tr style="font-size: 12px; padding: 10px" >';
    $mailbody  .= '<td>'.$user_order['Cash_Card_he'].'</td>';
    $mailbody  .= '<td style="text-align: right" dir="rtl">';
    $mailbody  .=  '&nbsp;'.$todayDate.'&nbsp;';
    $mailbody  .= '  #';
    $mailbody  .=  $orderId;
    $mailbody  .= '</tr>';
    $mailbody  .= '</table>';
    $mailbody  .= '</div>';
    $mailbody  .= '<div  style="padding: 10px 30px 0px 30px;" >';


    foreach($user_order['cartData'] as $t) {

        $mailbody.='<table style="width: 100%; color:black; padding: 30px 0; border-bottom: 1px solid #D3D3D3" >';
        $mailbody.='<tr style="font-size: 18px; padding: 10px; font-weight: bold" >';
        $mailbody.='<span style="color: #FF864C;" dir="rtl">';
        $mailbody.=(($t['price'] * $t['qty'])).'  " ';
        $mailbody.='</span> &nbsp; <span dir="rtl">"</span>';
        $mailbody.=$t['price'].' x '.$t['qty'].'</td>';
        $mailbody.='<td style="text-align: right;width: 60%" >'. $t['name_he'] .'</td>';
        $mailbody.='</tr>';
        $mailbody.='<tr style="font-size: 12px; padding: 5px 10px; color: #808080" >';
        $mailbody.='<td > </td>';



        if($t['specialRequest'] != "") {

            if ($t['detail_he'] == '') {


                $mailbody.='<td style="text-align: right; padding: 5px" dir="rtl">'.$t['detail_he'].'  : '.$t['specialRequest'].'</td>';

            }
            else {

                $mailbody.='<td style="text-align: right; padding: 5px" dir="rtl">'.$t['detail_he'].',  : '.$t['specialRequest'].'</td>';

            }
        }
        else
        {
            $mailbody.='<td style="text-align: right; padding: 5px" dir="rtl">'.$t['detail_he'].'</td>';

        }





        $mailbody.='</tr>';
        $mailbody.='</table>';
    }


    $mailbody .=  '</div>';

    if($user_order['specialRequest'] != '')
    {

        $mailbody .= '<br><span style="color: #000000;text-align: right;float: right;" dir="rtl"> <span style="color: #808080; padding:10px 30px;">  :</span>'.$user_order["specialRequest"].'</span><br>';

    }

    $mailbody .= '<table style="width: 100%; color:black; padding:10px 30px; background: #FEF2E8; border-bottom: 1px solid #D3D3D3 ">';

    if($user_order['isCoupon'] == "false")
    {

        $mailbody .= '<tr style="font-size: 18px;  font-weight: bold">';
        $mailbody .= '<td style=" white-space: nowrap"> <span style="color: #FF864C;" dir="rtl">'.$user_order['total'].' " '.'</span></td>';
        $mailbody .= '<td style="padding: 5px 0; text-align: right; " > " </td>';
        $mailbody .= '</tr>';

    }
    else
    {
        $mailbody .= '<tr style="font-size: 18px;  font-weight: bold">';
        $mailbody .= '<td style=" white-space: nowrap"> <span style="color: #FF864C;" >'.$user_order['totalWithoutDiscount'].' " '.'</span></td>';
        $mailbody .= '<td style="padding: 5px 0; text-align: right; " >   </td>';
        $mailbody .= '</tr>';


    }

    $mailbody .= '</table>';

    $mailbody .= '<table style="float: right;color:black; padding:10px 30px; width: 270px; position: relative; left: calc(100% - 270px)" cellspacing="5px">';
    $mailbody .= '<tr style="font-size: 18px;  font-weight: bold" >';
    $mailbody .= '<td colspan="2" style="padding: 10px 0; text-align: right" dir="rtl" >     </td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';
    $mailbody .= '<td style="text-align: right; white-space: nowrap"> '.$user_order['name'].' </td>';
    $mailbody .= '<td style="padding: 10px 0"><img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_user.png"></td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';
    $mailbody .= '<td style="text-align: right; white-space: nowrap"> '.$user_order['contact'].' </td>';
    $mailbody .= '<td style="padding: 10px 0"><img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_phone.png"></td>';
    $mailbody .= '</tr>';
    $mailbody .= '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';

    if($user_order['pickFromRestaurant'] == 'false')
    {
        $mailbody .= '<td style="text-align: right; white-space: nowrap" dir="rtl">   : '.$user_order['deliveryAptNo'].'  '.$user_order['deliveryAddress'].' ('.$user_order['deliveryArea'].')</td>';
    }
    else
    {
        $mailbody .= '<td style="text-align: right; white-space: nowrap"dir="rtl">     : '.$user_order['restaurantAddress'].'</td>';
    }

    $mailbody .=  '<td style="padding: 10px 0; text-align: center"> <img style="height: 24px" src="http://dev.orderapp.com/restapi/images/ic_location.png" ></td>';
    $mailbody .=  '</tr>';
    $mailbody .=  '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';
    $mailbody .=  '<td style="text-align: right; white-space: nowrap">'.$user_order['email'].'</td>';
    $mailbody .=  '<td style="padding: 10px 0;"><img style="width: 20px" src="http://dev.orderapp.com/restapi/images/ic_email.png" ></td>';
    $mailbody .=  '</tr>';
    $mailbody .=  '<tr style="font-size: 12px; padding: 5px 10px; color: #808080">';
    $mailbody .=  '<td style="text-align: right; white-space: nowrap">'.$user_order['Cash_Card_he'].'</td>';
    $mailbody .=  '<td style="padding: 10px 0;" > <img style=" width: 20px" src="http://dev.orderapp.com/restapi/images/ic_card.png" ></td>';
    $mailbody .=  '</tr>';
    $mailbody .=  '</table>';

    $mailbody .=  '</div></div></body></html>';


    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

    //From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


    //To address and name
    $mail->addAddress(EMAIL);                    //SEND ADMIN EMAIL


    //Address to which recipient will reply
    $mail->addReplyTo("order@orderapp.com", "Reply");


    //Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = $user_order['restaurantTitleHe']."   # "."  ".$orderId;
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send())
    {
        echo "Mailer Error: " . $mail->ErrorInfo;
    }
    else
    {
        echo "Message has been sent successfully";
    }

}




// ADMIN EMAIL
// EMAIL ORDER SUMMARY HEBREW VERSION FOR ADMIN
function email_for_kitchen($user_order,$orderId,$todayDate)
{

    $mailbody = '<html>
                  <head>
                  <meta charset="UTF-8">
                  </head>
                  <body style="padding: 15px; margin: 15px;font-size: 16px" dir="rtl" >';

    $mailbody .= ' <span dir="rtl">
          :  
        ' . $user_order['name'] . '
    </span>';

    $mailbody .= '<br>';

    $mailbody .= ' <span dir="rtl">
        :  
  ' . $user_order['contact'] . '
    </span>';

    $mailbody .= '<br>';


    if ($user_order['pickFromRestaurant'] == 'false') {
        $mailbody .= ' <span dir="rtl">
       :  
    '. $user_order['deliveryAptNo'] .' '. $user_order['deliveryAddress'] .' ('.$user_order['deliveryArea'].')'.'
    </span>';

    }
    else
    {
        $mailbody .= ' <span dir="rtl">
       :  
     
    </span>';
    }

    $mailbody .= '<br>';

    $mailbody .= ' <span dir="rtl">
      :  
   ' . substr($user_order['contact'], -4) . '
    </span>';



    if($user_order['specialRequest'] != '')
    {

        $mailbody .= '<br>';

        $mailbody .= ' <span dir="rtl">
       :  
   ' . $user_order["specialRequest"]  . '
    </span>';


    }

    $mailbody .= '<br>';
    $mailbody .= '<br>';
    $mailbody .= '<br>';

    foreach ($user_order['cartData'] as $t) {


        $mailbody .= '<span dir="rtl">' . $t['qty'] . '  ' . $t['name_he'] . '</span>';
        $mailbody .= '<br>';



        if($t['specialRequest'] != "") {

            if ($t['detail_he'] == '') {


                $mailbody .= '<span dir="rtl">' . preg_replace("/\([^)]+\)/", "", $t['detail_he']).'  : '.$t['specialRequest'].'</span>';


            }
            else {


                $mailbody .= '<span dir="rtl">' . preg_replace("/\([^)]+\)/", "", $t['detail_he']).',  : '.$t['specialRequest'].'</span>';


            }
        }
        else
        {
            $mailbody .= '<span dir="rtl">' . preg_replace("/\([^)]+\)/", "", $t['detail_he']) . '</span>';

        }






        $mailbody .= '<br>';
        $mailbody .= '<br>';

    }

    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

    //From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


    //To address and name
    $mail->addAddress(EMAIL);                    //SEND ADMIN EMAIL


    //Address to which recipient will reply
    $mail->addReplyTo("order@orderapp.com", "Reply");


    //Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = "   ".substr($user_order['contact'], -4) . " #" . $user_order['restaurantTitleHe'];
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send()) {
        echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        echo "Message has been sent successfully";
    }

}




function email_for_mark($user_order,$orderId,$todayDate)
{

    $mailbody = '';

    $mailbody .= '  :'. $user_order['name'];
    $mailbody .= '\n';

    $mailbody .= ' : '.$user_order['contact'];
    $mailbody .= '\n';

    if ($user_order['pickFromRestaurant'] == 'false') {
        $mailbody .= ':'. $user_order['deliveryAptNo'] .' '. $user_order['deliveryAddress'] .' ('.$user_order['deliveryArea'].')';
    }
    else
    {
        $mailbody .= ':  ';
    }

    $mailbody .= '\n';

    $mailbody .= ':' . substr($user_order['contact'], -4);

    if($user_order['specialRequest'] != '')
    {
        $mailbody .= '\n';

        $mailbody .= ' : ' . $user_order["specialRequest"];
    }

    $mailbody .= '\n';
    $mailbody .= '\n';
    $mailbody .= '\n';

    foreach ($user_order['cartData'] as $t) {


        $mailbody .= $t['qty'] . '  ' . $t['name_he'] . '  ' . $t['price'];
        $mailbody .= '\n';



        if($t['specialRequest'] != "") {

            if ($t['detail_he'] == '') {


                $mailbody .= preg_replace("/\([^)]+\)/", "", $t['detail_he']).'  : '.$t['specialRequest'];


            }
            else {


                $mailbody .= preg_replace("/\([^)]+\)/", "", $t['detail_he']).',  : '.$t['specialRequest'];


            }
        }
        else
        {
            $mailbody .= preg_replace("/\([^)]+\)/", "", $t['detail_he']);

        }


        $mailbody .= $user_order['total'] . '" ';
        $mailbody .= '\n';
        $mailbody .= '\n';

    }

    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

    //From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


    //To address and name
    $mail->addAddress(EMAIL);                    //SEND ADMIN EMAIL


    //Address to which recipient will reply
    $mail->addReplyTo("order@orderapp.com", "Reply");


    //Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = "   ".substr($user_order['contact'], -4) . " #" . $user_order['restaurantTitleHe'];
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send()) {
        echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        echo "Message has been sent successfully";
    }

}






function email_for_mark2($user_order,$orderId,$todayDate)
{

    $mailbody = '';

    $mailbody .= 'Name :'. $user_order['name'];
    $mailbody .= '\n';

    $mailbody .= 'Email :'. $user_order['email'];
    $mailbody .= '\n';

    $mailbody .= 'Contact :'. $user_order['contact'];
    $mailbody .= '\n';

    $mailbody .= 'Restaurant Name :'. $user_order['restaurantTitle'];
    $mailbody .= '\n';

    $mailbody .= 'Payment Method : '.$user_order['Cash_Card'];
    $mailbody .= '\n';

    if ($user_order['pickFromRestaurant'] == 'false') {

        $mailbody .= 'Delivery Charges : '. $user_order['deliveryCharges'];
        $mailbody .= '\n';
        $mailbody .= 'Appt No : '. $user_order['deliveryAptNo'];
        $mailbody .= '\n';
        $mailbody .= ' Address : '. $user_order['deliveryAddress'];
        $mailbody .= '\n';
        $mailbody .=  ' Area : ('.$user_order['deliveryArea'].')';
    }
    else
    {
        $mailbody .= 'Pick Up : Pick From Restaurant';
    }


    if($user_order['isCoupon']) {

        $mailbody .= '\n';
        $mailbody .= 'coupon code : ' . $user_order['couponCode'];
        $mailbody .= '\n';

        if ($user_order['isFixAmountCoupon'] == 'true') {

            $mailbody .= 'Discount : ' . $user_order['discount'] . ' NIS';
        } else {

            $mailbody .= 'Discount : ' . $user_order['discount'] . ' %';
        }


    }


    $mailbody .= '\n';
    $mailbody .= 'Total Without Discount : '.$user_order['totalWithoutDiscount'];
    $mailbody .= '\n';
    $mailbody .= 'Total : '.$user_order['total'];

    $mailbody .= '\n';
    $mailbody .= '\n';


    $mail = new PHPMailer;

    $mail->CharSet = 'UTF-8';

    $mail->SMTPDebug = 3;                                               // Enable verbose debug output

    $mail->isSMTP();
    $mail->Host = "email-smtp.eu-west-1.amazonaws.com";                 //   Set mailer to use SMTP
    $mail->SMTPAuth = true;                                             //   Enable SMTP authentication
    $mail->Username = "AKIAJZTPZAMJBYRSJ27A";
    $mail->Password = "AujjPinHpYPuio4CYc5LgkBrSRbs++g9sJIjDpS4l2Ky";   //   SMTP password
    $mail->SMTPSecure = 'tls';                                          //   Enable TLS encryption, `ssl` also accepted
    $mail->Port = 587;

//From email address and name
    $mail->From = "order@orderapp.com";
    $mail->FromName = "OrderApp";


//To address and name
    $mail->addAddress(EMAIL);                    //SEND ADMIN EMAIL


//Address to which recipient will reply
    $mail->addReplyTo("order@orderapp.com", "Reply");


//Send HTML or Plain Text email
    $mail->isHTML(false);
    $mail->Subject = 'Ledger '.$user_order['restaurantTitle'].' Order# '.$orderId;
    $mail->Body = $mailbody;
    $mail->AltBody = "OrderApp";

    if (!$mail->send()) {
        echo "Mailer Error: " . $mail->ErrorInfo;
    }
    else {
        echo "Message has been sent successfully";
    }

}


// BRING SEND ADDRESS OF DELIVERY


function createBringgTask($user_order, $todayDate, $delivery_time) {

    $url = 'https://admin-api.bringg.com//services/6f15901b/caa8a0ea-0b7a-4bd6-87cb-f07c77d66c48/27e666d2-e7cd-4917-988b-aa109829f0c4/';

    if ($user_order['pickFromRestaurant'] == 'true'){
        return;
    }



    date_default_timezone_set('Asia/Jerusalem');
    $ScheduledAt = print_r($todayDate . 'T' . $delivery_time . ':00z',true);

    $order_text = '';
    $order_text .= $user_order['restaurantTitleHe'] .'\n';

    foreach ($user_order['cartData'] as $t) {
        $order_text .= $t['qty'] . '  ' . $t['name_he'] .'\n';
        $order_text .= preg_replace("/\([^)]+\)/", "", $t['detail_he']).'\n\n';
    }

    $jason = print_r('{
       "company_id": 666,
       "title": "Delivery",      // Title for the Task being created.
       "scheduled_at": "' . $ScheduledAt . '",   // Here the  $ScheduledAt variable is an example for the date and time format.
       "note": "' . $order_text . '",
       "customer": {
          "name": "' . $user_order['name'] . '",
          "address": "' . $user_order['deliveryAddress'] . '",
          "phone": "' . $user_order['contact'] . '"
       },
       "way_points":[
          {
             "customer":{
                "name": "' . $user_order['restaurantTitleHe'] . '",
                "phone": "026222862"
             },
             "address":"'.$user_order['deliveryAddress'].' ('.$user_order['deliveryArea'].')",
             "restaurantAddress":"'.$user_order['restaurantAddress'].'"
            "allow_editing_inventory": "true", // Allow driver to edit the Inventory e.g. change quantities?
            "must_approve_inventory": "true",   // Driver must approve pick up inventory e.g. by scanning it. The driver won\'t be allowed to leave location without doing this.
            "allow_scanning_inventory": "true"  // Allow to scan inventory via phone camera (on the Driver App)
          },
          {
             "customer":{
                "name":"' . $user_order['name'] . '",
                "phone":"' . $user_order['contact'] . '"
             },
             "address":"' . $user_order['deliveryAddress'] . '",
            "allow_editing_inventory": "true",    // Allow driver to edit the Inventory e.g. change quantities?
            "must_approve_inventory": "true",   // Driver must approve drop off inventory e.g. by scanning it. The driver won\'t be allowed to leave location and finish the task without doing this.
            "allow_scanning_inventory": "true" // Allow to scan inventory via phone camera (on the Driver App)
          }
       ]
    }',true);



    $ch=curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_POSTFIELDS, $jason);
    curl_setopt($ch, CURLOPT_HTTPHEADER,
        array('Content-Type:application/json',
            'Content-Length: ' . strlen($jason))
    );

    $json_response = curl_exec($ch);

    $status = curl_getinfo($ch, CURLINFO_HTTP_CODE);

    if ( $status != 200 ) {

        //die("Error: call to URL $url failed with status $status, response $json_response, curl_error " . curl_error($curl) . ", curl_errno " . curl_errno($curl));

    }

    curl_close($ch);

}




function createOrderForTelegram($user_order)
{
    $mailBody = '';
    $mailBody = "  ".substr($user_order['contact'], -4) . " #" . $user_order['restaurantTitleHe'].'
    
    ';

    $mailBody .= '  :' . $user_order['name'] . '
    
    ';
    $mailBody .= ' :' . $user_order['contact'] . '
    
    ';

    if ($user_order['pickFromRestaurant'] == 'false') {

        $mailBody .= ':  '. $user_order['deliveryAptNo'] .' '. $user_order['deliveryAddress'] .' ('.$user_order['deliveryArea'].')'.' 
        
        ';
    }
    else
    {
        $mailBody .= ':  '.'
        
        ' ;
    }

    $mailBody .= ' :' . substr($user_order['contact'], -4) . ' 
    
    ';


    if($user_order['specialRequest'] != '')
    {

        $mailBody .= ' :' . $user_order["specialRequest"] . ' 
    
       ';
    }



    foreach ($user_order['cartData'] as $t) {

        $mailBody .=  $t['qty'] . '  ' . $t['name_he'] . ' 
        
        ';

        if($t['specialRequest'] != "") {


            if ($t['detail_he'] == '') {


                $mailBody .=  preg_replace("/\([^)]+\)/", "", $t['detail_he']).' :'.$t['specialRequest'].' 
                
                ';

            }
            else {


                $mailBody .= preg_replace("/\([^)]+\)/", "", $t['detail_he']).' , :'.$t['specialRequest'].' 
               
                ';

            }
        }
        else
        {
            $mailBody .= preg_replace("/\([^)]+\)/", "", $t['detail_he']) . ' 
            
            ';

        }
    }






    return $mailBody;
}




//  TELEGRAM API
//  SEND ORDERS THROUGH TELEGRAM

function telegramAPI($bot_id, $chat_id, $text) {


    $postData = array(
        'chat_id' => $chat_id,
        'text' => $text
    );


    $headers = array(
        'Content-Type: application/json'
    );


    $url = 'https://api.telegram.org/bot'.$bot_id.'/sendMessage';


    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($postData));
    $response = curl_exec($ch);
    echo "Response: ".$response;
    curl_close($ch);


}
function getCurrentTime(){

    //CURRENT TIME OF ISRAEL
    date_default_timezone_set("Asia/Jerusalem");
    $currentTime           =    date("H:i:s");

    return $currentTime;
}

?>

